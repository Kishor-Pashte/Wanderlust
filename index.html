<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Razorpay Payment</title>
  </head>
  <body>
    <h1>Razorpay Payment Gateway Integration</h1>
    <form id="payment-form">
      <label for="amount">Amount:</label>
      <input type="number" id="amount" name="amount" required />
      <button type="button" onclick="payNow()">Pay Now</button>
    </form>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
      async function payNow() {
        const amount = document.getElementById("amount").value;

        // 1. Ask backend to create an order
        const response = await fetch("/create-order", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            amount,
            currency: "INR",
            receipt: "receipt#1",
            notes: {},
          }),
        });

        const order = await response.json();

        // 2. Use order details in Razorpay checkout
        const options = {
          key: "rzp_test_R5Dz7E9ZA9ddqZ", // replace with process.env.RAZORPAY_KEY_ID in production
          amount: order.amount, // comes from backend
          currency: order.currency,
          name: "Wanderlust",
          description: "Test Transaction",
          order_id: order.id,
          handler: async function (response) {
            // 3. Verify payment with backend
            const verify = await fetch("/verify-payment", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(response),
            });

            const result = await verify.json();
            console.log("Verify result:", result);

            if (result.status === "ok") {
              alert("Payment Successful!");
              window.location.href = "/payment-success"; // redirect to success page
            } else {
              alert("Payment Verification Failed!");
            }
          },
          prefill: {
            name: "Kishor Pashte",
            email: "kishorpashte@gmail.com",
            contact: "7499390397",
          },
          theme: { color: "#F37254" },
        };

        const rzp = new Razorpay(options);
        rzp.open();
      }
    </script>
  </body>
</html>
